// Mapping des noms de récitateurs arabes vers français/anglais
export const reciterNameMapping = {
  // Noms arabes vers français
  'عبد الباسط عبد الصمد': 'Abdul Basit Abdul Samad',
  'مشاري بن راشد العفاسي': 'Mishary Rashid Al-Afasy',
  'ماهر المعيقلي': 'Maher Al-Muaiqly',
  'سعد الغامدي': 'Saad Al-Ghamdi',
  'عبد الرحمن السديس': 'Abdul Rahman Al-Sudais',
  'سعود الشريم': 'Saud Al-Shuraim',
  'ناصر القطامي': 'Nasser Al-Qatami',
  'أحمد بن علي العجمي': 'Ahmed Al-Ajmi',
  'محمد صديق المنشاوي': 'Mohamed Siddiq Al-Minshawi',
  'عبد الله بصفر': 'Abdullah Basfar',
  'خالد الجليل': 'Khalid Al-Jalil',
  'فارس عباد': 'Fares Abbad',
  'ياسر الدوسري': 'Yasser Al-Dosari',
  'عبد الله الجهني': 'Abdullah Al-Juhani',
  'محمد البراك': 'Mohammed Al-Barrak',
  'عبد الله عواد الجهني': 'Abdullah Awad Al-Juhani',
  'عبد الله الموسى': 'Abdullah Al-Mousa',
  'توفيق الصايغ': 'Tawfiq Al-Sayegh',
  'محمد المحيسني': 'Mohammed Al-Mohaisany',
  'عبد المحسن القاسم': 'Abdul Mohsen Al-Qasim',
  'صلاح البدير': 'Salah Al-Budair',
  'عبد الله المطرود': 'Abdullah Al-Matrood',
  'عبد الله الكندري': 'Abdullah Al-Kandari',
  'محمد اللحيدان': 'Mohammed Al-Luhaidan',
  'عبد الله خياط': 'Abdullah Khayyat',
  'عبد الرحمن العوسي': 'Abdul Rahman Al-Ossi',
  'محمد عبد الكريم': 'Mohammed Abdul Kareem',
  'أكرم العلاقمي': 'Akram Al-Alaqmi',
  'عبد الله الجبرين': 'Abdullah Al-Jibreen',
  'محمد الطبلاوي': 'Mohammed Al-Tablawi',
  'عبد الباري محمد': 'Abdul Bari Mohammed',
  'عبد الله بن سعد': 'Abdullah Bin Saad',
  'محمد حسان': 'Mohammed Hassan',
  'عبد الله الخلف': 'Abdullah Al-Khalaf',
  'محمد الغزالي': 'Mohammed Al-Ghazali',
  'عبد الرحمن الحذيفي': 'Abdul Rahman Al-Hudhaifi',
  'سالم الرويلي': 'Salem Al-Ruwaili',
  'عبد الله الأحمد': 'Abdullah Al-Ahmad',
  'محمد الشنقيطي': 'Mohammed Al-Shanqeeti',
  'عبد الله العبيكان': 'Abdullah Al-Obaikan',
  'محمد الحبشي': 'Mohammed Al-Habashi',
  'عبد الله الزامل': 'Abdullah Al-Zamel',
  'محمد الكندري': 'Mohammed Al-Kandari',
  'عبد الله الدوسري': 'Abdullah Al-Dosari',
  'محمد العريفي': 'Mohammed Al-Arifi',
  'عبد الله السلمي': 'Abdullah Al-Salmi',
  'محمد الشريف': 'Mohammed Al-Shareef',
  'عبد الله الحارثي': 'Abdullah Al-Harthi',
  'محمد الفهد': 'Mohammed Al-Fahd',
  'عبد الله الرشيد': 'Abdullah Al-Rashid',
  'محمد الزهراني': 'Mohammed Al-Zahrani',
  'عبد الله الخضير': 'Abdullah Al-Khudair',
  'محمد الحسن': 'Mohammed Al-Hassan',
  'عبد الله الفوزان': 'Abdullah Al-Fawzan',
  'محمد الراجحي': 'Mohammed Al-Rajhi',
  'عبد الله الغنيمان': 'Abdullah Al-Ghuniman',
  'محمد الصاعدي': 'Mohammed Al-Saedi',
  'عبد الله الطيار': 'Abdullah Al-Tayyar',
  'محمد الشثري': 'Mohammed Al-Shathri',
  'عبد الله الفريح': 'Abdullah Al-Freeh',
  'محمد الخضيري': 'Mohammed Al-Khudairi',
  'عبد الله الجار الله': 'Abdullah Al-Jarallah',
  'محمد الدبيان': 'Mohammed Al-Dubaian',
  'عبد الله الركبان': 'Abdullah Al-Rukban',
  'محمد الشويعر': 'Mohammed Al-Shuwaier',
  'عبد الله الغديان': 'Abdullah Al-Ghudayan',
  'محمد الفراج': 'Mohammed Al-Farraj',
  'عبد الله الطريقي': 'Abdullah Al-Turayqi',
  'محمد الحمود': 'Mohammed Al-Hamoud',
  'عبد الله الجلالي': 'Abdullah Al-Jalali',
  'محمد الشنقيطي': 'Mohammed Al-Shanqeeti',
  'عبد الله الأنصاري': 'Abdullah Al-Ansari',
  'محمد الحصين': 'Mohammed Al-Husayn',
  'عبد الله الغامدي': 'Abdullah Al-Ghamdi',
  'محمد الشيخ': 'Mohammed Al-Sheikh',
  'عبد الله الحكمي': 'Abdullah Al-Hakmi',
  'محمد الفقيه': 'Mohammed Al-Faqih',
  'عبد الله الجبير': 'Abdullah Al-Jubair',
  'محمد الشهري': 'Mohammed Al-Shahri',
  'عبد الله الحربي': 'Abdullah Al-Harbi',
  'محمد الطيب': 'Mohammed Al-Tayeb',
  'عبد الله الشمري': 'Abdullah Al-Shamri',
  'محمد الأمين': 'Mohammed Al-Ameen',
  'عبد الله القرني': 'Abdullah Al-Qarni',
  'محمد الحسني': 'Mohammed Al-Hasani',
  'عبد الله الزهراني': 'Abdullah Al-Zahrani',
  'محمد الشافعي': 'Mohammed Al-Shafei',
  'عبد الله المالكي': 'Abdullah Al-Maliki',
  'محمد الحنبلي': 'Mohammed Al-Hanbali',
  'عبد الله الحنفي': 'Abdullah Al-Hanafi'
};

// Fonction pour traduire un nom de récitateur
export const translateReciterName = (arabicName) => {
  // Nettoyer le nom (enlever les espaces supplémentaires)
  const cleanName = arabicName?.trim();

  // Chercher dans le mapping
  const translatedName = reciterNameMapping[cleanName];

  // Si trouvé, retourner la traduction, sinon retourner le nom original
  return translatedName || cleanName || 'Récitateur Inconnu';
};

// Fonction pour normaliser les noms pour la recherche
export const normalizeForSearch = (name) => {
  if (!name || typeof name !== 'string') {
    return '';
  }

  try {
    return name
      .toLowerCase()
      .normalize('NFD')
      .replace(/[\u0300-\u036f]/g, '') // Enlever les accents
      .replace(/[^\w\s]/g, '') // Enlever la ponctuation
      .replace(/\s+/g, ' ') // Normaliser les espaces
      .trim();
  } catch (error) {
    console.warn('Erreur normalisation:', error);
    return name.toLowerCase().trim();
  }
};

// Fonction pour rechercher dans les noms traduits
export const searchReciters = (reciters, query) => {
  // Vérifications de sécurité
  if (!reciters || !Array.isArray(reciters)) {
    console.warn('searchReciters: reciters doit être un tableau');
    return [];
  }

  if (!query || typeof query !== 'string' || !query.trim()) {
    return reciters;
  }

  try {
    const normalizedQuery = normalizeForSearch(query);
    const searchTerms = normalizedQuery.split(' ').filter(term => term.length > 0);

    if (searchTerms.length === 0) {
      return reciters;
    }

    return reciters
      .map(reciter => {
        // Vérifications de sécurité pour chaque récitateur
        if (!reciter || typeof reciter !== 'object') {
          console.warn('Récitateur invalide:', reciter);
          return null;
        }

        // Obtenir le nom à utiliser (name ou originalName)
        const reciterName = reciter.name || reciter.originalName || '';
        const originalName = reciter.originalName || reciter.name || '';

        // Traduire le nom pour la recherche
        const translatedName = translateReciterName(reciterName);
        const normalizedTranslated = normalizeForSearch(translatedName);
        const normalizedOriginal = normalizeForSearch(originalName);
        const normalizedCurrent = normalizeForSearch(reciterName);

        let score = 0;

        searchTerms.forEach(term => {
          if (!term) return;

          // Recherche dans le nom traduit
          if (normalizedTranslated && normalizedTranslated.includes(term)) {
            score += 3;
            if (normalizedTranslated.startsWith(term)) {
              score += 2;
            }
          }

          // Recherche dans le nom original (arabe)
          if (normalizedOriginal && normalizedOriginal.includes(term)) {
            score += 2;
          }

          // Recherche dans le nom actuel
          if (normalizedCurrent && normalizedCurrent.includes(term)) {
            score += 2;
          }

          // Recherche dans la langue
          const language = reciter.language || '';
          if (normalizeForSearch(language).includes(term)) {
            score += 1;
          }
        });

        return {
          ...reciter,
          searchScore: score,
          translatedName,
          displayName: translatedName || reciterName || 'Récitateur Inconnu'
        };
      })
      .filter(reciter => reciter && reciter.searchScore > 0)
      .sort((a, b) => b.searchScore - a.searchScore);

  } catch (error) {
    console.error('Erreur dans searchReciters:', error);
    return reciters; // Retourner la liste originale en cas d'erreur
  }
};